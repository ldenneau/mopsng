{\rtf1\mac\ansicpg10000\cocoartf824\cocoasubrtf390
{\fonttbl\f0\fswiss\fcharset77 Helvetica;\f1\fswiss\fcharset77 Helvetica-Bold;\f2\fswiss\fcharset77 Helvetica-Oblique;
}
{\colortbl;\red255\green255\blue255;}
{\*\listtable{\list\listtemplateid1\listhybrid{\listlevel\levelnfc0\levelnfcn0\leveljc2\leveljcn2\levelfollow0\levelstartat1\levelspace360\levelindent0{\*\levelmarker \{decimal\}.}{\leveltext\leveltemplateid0\'02\'05.;}{\levelnumbers\'01;}}{\listlevel\levelnfc23\levelnfcn23\leveljc2\leveljcn2\levelfollow0\levelstartat1\levelspace360\levelindent0{\*\levelmarker \{hyphen\}}{\leveltext\leveltemplateid1\'02\'05.;}{\levelnumbers\'01;}}{\listname ;}\listid1}
{\list\listtemplateid2\listhybrid{\listlevel\levelnfc0\levelnfcn0\leveljc2\leveljcn2\levelfollow0\levelstartat1\levelspace360\levelindent0{\*\levelmarker \{decimal\}.}{\leveltext\leveltemplateid0\'02\'05.;}{\levelnumbers\'01;}}{\listname ;}\listid2}
{\list\listtemplateid3\listhybrid{\listlevel\levelnfc0\levelnfcn0\leveljc2\leveljcn2\levelfollow0\levelstartat1\levelspace360\levelindent0{\*\levelmarker \{decimal\}.}{\leveltext\leveltemplateid0\'02\'05.;}{\levelnumbers\'01;}}{\listname ;}\listid3}
{\list\listtemplateid4\listhybrid{\listlevel\levelnfc0\levelnfcn0\leveljc2\leveljcn2\levelfollow0\levelstartat1\levelspace360\levelindent0{\*\levelmarker \{decimal\}.}{\leveltext\leveltemplateid0\'02\'05.;}{\levelnumbers\'01;}}{\listname ;}\listid4}
{\list\listtemplateid5\listhybrid{\listlevel\levelnfc0\levelnfcn0\leveljc2\leveljcn2\levelfollow0\levelstartat1\levelspace360\levelindent0{\*\levelmarker \{decimal\}.}{\leveltext\leveltemplateid0\'02\'05.;}{\levelnumbers\'01;}}{\listname ;}\listid5}
{\list\listtemplateid6\listhybrid{\listlevel\levelnfc0\levelnfcn0\leveljc2\leveljcn2\levelfollow0\levelstartat1\levelspace360\levelindent0{\*\levelmarker \{decimal\}.}{\leveltext\leveltemplateid0\'02\'05.;}{\levelnumbers\'01;}}{\listname ;}\listid6}}
{\*\listoverridetable{\listoverride\listid1\listoverridecount0\ls1}{\listoverride\listid2\listoverridecount0\ls2}{\listoverride\listid3\listoverridecount0\ls3}{\listoverride\listid4\listoverridecount0\ls4}{\listoverride\listid5\listoverridecount0\ls5}{\listoverride\listid6\listoverridecount0\ls6}}
{\info
{\title PS-MOPS Installation Guide}
{\author Francesco Pierfederici}
{\*\company LSST}}\margl1440\margr1440\vieww13740\viewh14380\viewkind0
\pard\tx720\tx1440\tx2160\tx2880\tx3600\tx4320\tx5040\tx5760\tx6480\tx7200\tx7920\tx8640\qj\pardirnatural

\f0\fs24 \cf0 \
\pard\tx720\tx1440\tx2160\tx2880\tx3600\tx4320\tx5040\tx5760\tx6480\tx7200\tx7920\tx8640\qc\pardirnatural

\f1\b\fs44 \cf0 Pan-STARRS Moving Object Pipeline System Installation Guide
\f0\b0\fs24 \
\pard\tx720\tx1440\tx2160\tx2880\tx3600\tx4320\tx5040\tx5760\tx6480\tx7200\tx7920\tx8640\qc\pardirnatural

\f2\i \cf0 Francesco Pierfederici <fpierfed@lsstorg>
\f0\i0 \

\f2\i June 16, 2006
\f0\i0 \
\pard\tx720\tx1440\tx2160\tx2880\tx3600\tx4320\tx5040\tx5760\tx6480\tx7200\tx7920\tx8640\qj\pardirnatural
\cf0 \
\
\
\

\f1\b\fs28 Introduction
\f0\b0\fs24 \
The Pan-STARRS Moving Object Pipeline System (PS-MOPS) is a sophisticated software package able to processes catalogues of detections of transient objects (generated by, say, an image differencing pipeline) and produces a list of orbits fitted to a subset of these detections.\
\
\

\f1\b\fs28 Getting the code
\f0\b0\fs24 \
The best way to get the PS-MOPS code is by checking out a copy from the CVS repository:\
\
\pard\tx560\tx1120\tx1680\tx2240\tx2800\tx3360\tx3920\tx4480\tx5040\tx5600\tx6160\tx6720\qj\pardirnatural
\cf0 	shell> cvs -z3 -d:{\field{\*\fldinst{HYPERLINK "mailto:fpierfed@cvs.pan-starrs.ifa.hawaii.edu"}}{\fldrslt <username>@cvs.pan-starrs.ifa.hawaii.edu}}:/cvsroot/pan-starrs co MOPS\
\
At the time of writing, the CVS repository does not support anonymous users. One thing to keep in mind is that 
\f2\i some data files are not stored in CVS
\f0\i0  (more about those later; for now suffice to say that the repository copy of "MOPS/src/ssm" is not complete). While it might be possible to generate them from scratch, it has proven useful to have a working installation handy to copy those data files from. \
\
\
\pard\tx720\tx1440\tx2160\tx2880\tx3600\tx4320\tx5040\tx5760\tx6480\tx7200\tx7920\tx8640\qj\pardirnatural

\f1\b\fs28 \cf0 Requirements
\f0\b0\fs24 \
\pard\tx560\tx1120\tx1680\tx2240\tx2800\tx3360\tx3920\tx4480\tx5040\tx5600\tx6160\tx6720\qj\pardirnatural
\cf0 PS-MOPS has two types of requirements. On one hand, it relies upon a number of external packages. On the other hand it contains
\f2\i  code that will only run on linux x86
\f0\i0 . \
\

\f1\b SW Requirements
\f0\b0 \
What follows is a list of third party pieces of software that need to be installed on the system before attempting to build and run PS-MOPS:\
\pard\tx220\tx720\tx1120\tx1680\tx2240\tx2800\tx3360\tx3920\tx4480\tx5040\tx5600\tx6160\tx6720\li720\fi-720\qj\pardirnatural
\ls1\ilvl0\cf0 {\listtext	1.	}SLALIB/C\
{\listtext	2.	}ncurses\
{\listtext	3.	}JPL software:\
\pard\tx940\tx1440\tx1680\tx2240\tx2800\tx3360\tx3920\tx4480\tx5040\tx5600\tx6160\tx6720\li1440\fi-1440\qj\pardirnatural
\ls1\ilvl1\cf0 {\listtext	\uc0\u8259 	}coarseEphem\
{\listtext	\uc0\u8259 	}genEphem\
{\listtext	\uc0\u8259 	}ps_eph\
{\listtext	\uc0\u8259 	}genOrbit\
{\listtext	\uc0\u8259 	}ps_od\
\pard\tx220\tx720\tx1440\tx1680\tx2240\tx2800\tx3360\tx3920\tx4480\tx5040\tx5600\tx6160\tx6720\li720\fi-720\qj\pardirnatural
\ls1\ilvl0\cf0 {\listtext	4.	}Perl 5\
\ls1\ilvl0{\listtext	5.	}Python 2.2 or later (only for the installation script)\
\pard\tx220\tx720\tx1120\tx1680\tx2240\tx2800\tx3360\tx3920\tx4480\tx5040\tx5600\tx6160\tx6720\li720\fi-720\qj\pardirnatural
\ls1\ilvl0\cf0 {\listtext	6.	}Perl modules:\
\pard\tx940\tx1440\tx1680\tx2240\tx2800\tx3360\tx3920\tx4480\tx5040\tx5600\tx6160\tx6720\li1440\fi-1440\qj\pardirnatural
\ls1\ilvl1\cf0 {\listtext	\uc0\u8259 	}Astro\
{\listtext	\uc0\u8259 	}Astro::SLA\
{\listtext	\uc0\u8259 	}Class::Accessor\
{\listtext	\uc0\u8259 	}Config::Scoped\
{\listtext	\uc0\u8259 	}Error\
{\listtext	\uc0\u8259 	}File::Slurp\
{\listtext	\uc0\u8259 	}Log::Log4perl\
{\listtext	\uc0\u8259 	}Module::Build\
{\listtext	\uc0\u8259 	}Params::Validate\
{\listtext	\uc0\u8259 	}Parse::RecDescent\
\pard\tx220\tx720\tx1440\tx1680\tx2240\tx2800\tx3360\tx3920\tx4480\tx5040\tx5600\tx6160\tx6720\li720\fi-720\qj\pardirnatural
\ls1\ilvl0\cf0 {\listtext	7.	}MySQL 4 or later\
{\listtext	8.	}GCC 3 or later\
{\listtext	9.	}lf9562 FORTRAN compiler (possibly g77?)\
{\listtext	10.	}libg2c\
\pard\tx560\tx1120\tx1680\tx2240\tx2800\tx3360\tx3920\tx4480\tx5040\tx5600\tx6160\tx6720\qj\pardirnatural
\cf0 \
\

\f1\b Environment
\f0\b0 \
At the moment, PS-MOPS can run as any UNIX user; however it will spawn worker processes as user "mops". This means that:\
\pard\tx220\tx720\tx1120\tx1680\tx2240\tx2800\tx3360\tx3920\tx4480\tx5040\tx5600\tx6160\tx6720\li720\fi-720\qj\pardirnatural
\ls2\ilvl0\cf0 {\listtext	1.	}The user "mops" has to be defined and configured on every machine running PS-MOPS.\
{\listtext	2.	}Only one instance of PS-MOPS can run an any given machine at any given time. This is to avoid the user mops overwriting the other session temporary files (this claim needs to be investigated further).\
\pard\tx720\tx1120\tx1680\tx2240\tx2800\tx3360\tx3920\tx4480\tx5040\tx5600\tx6160\tx6720\qj\pardirnatural
\cf0 It is true that this behaviour could, in principle, be changed. However, some source files have the assumption of the existence of a "mops" user on the system hardcoded in.\
\
Every user running PS-MOPS (including the mops user) needs the following environment variables to be set:\
	# MOPS environment\
\pard\tx560\tx1120\tx1680\tx2240\tx2800\tx3360\tx3920\tx4480\tx5040\tx5600\tx6160\tx6720\ql\qnatural\pardirnatural
\cf0 	setenv MOPS_HOME /usr/local/MOPS_DEV\
	setenv MOPS_DBINSTANCE psmops_$\{USER\}\
	setenv MOPS_VAR $MOPS_HOME/var/$MOPS_DBINSTANCE\
	setenv CAET_DATA $MOPS_HOME/data/caet_data\
	setenv PATH $MOPS_VAR/bin:$MOPS_HOME/bin:$PATH\
	setenv LD_LIBRARY_PATH $MOPS_HOME/lib:$LD_LIBRARY_PATH\
	# MOPS Perl modules\
	setenv PERL5LIB $MOPS_HOME/lib/perl5\
\
The mops user home directory needs to have these files:\
	$HOME/bin\
	$HOME/bin/coarseEphem\
	$HOME/bin/shape.x\
	$HOME/bin/genEphem2\
	$HOME/data\
	$HOME/data/caet_data\
	$HOME/data/caet_data/obscode.jpl\
	$HOME/data/caet_data/EOP\
	$HOME/data/caet_data/EOP/20041223.dat\
	$HOME/data/caet_data/EOP/latest\
	$HOME/data/caet_data/EOP/20060131.dat\
	$HOME/data/caet_data/EOP/20050520.dat\
	$HOME/data/caet_data/EOP/20041222.dat\
	$HOME/data/caet_data/EOP/20051109.dat\
	$HOME/data/caet_data/EOP/eop.dat.dist\
	$HOME/data/caet_data/sbeph.nio\
	$HOME/data/caet_data/sb405-cpv-2.nio\
	$HOME/data/caet_data/eop.dat\
	$HOME/data/caet_data/de405.nio\
	$HOME/data/caet_data/obscode.mpc\
	$HOME/data/caet_data/etmut.dat\
	$HOME/data/caet_data/pleph.nio\
	$HOME/lib\
	$HOME/lib/libmopsephem.so\
	$HOME/var\
\
SSH for both mops and the user accounts has to be configured in such a way as to give password-less login to and from every machine running PS-MOPS and to and from every user account running PS-MOPS and the mops account. Every host running PS-MOPS needs also to be in the "known_hosts" file of each user account (including the mops account).\
\
Besides these requirements, all third party support software (e.g. MySQL) should be installed in the PATH and LD_LIBRARY_PATH as appropriate.\
\
\pard\tx560\tx1120\tx1680\tx2240\tx2800\tx3360\tx3920\tx4480\tx5040\tx5600\tx6160\tx6720\qj\pardirnatural
\cf0 \

\f1\b HW Requirements
\f0\b0 \
\pard\tx220\tx720\tx1120\tx1680\tx2240\tx2800\tx3360\tx3920\tx4480\tx5040\tx5600\tx6160\tx6720\li720\fi-720\qj\pardirnatural
\ls3\ilvl0\cf0 {\listtext	1.	}PS-MOPS requires a linux x86 system. \
{\listtext	2.	}By default the software is installed under /usr/local/MOPS_DEV and that directory must already exist. \
{\listtext	3.	}The whole PS-MOPS takes about 5 GB of disk.\
\pard\tx720\tx1440\tx2160\tx2880\tx3600\tx4320\tx5040\tx5760\tx6480\tx7200\tx7920\tx8640\qj\pardirnatural
\cf0 \
\

\f1\b\fs28 Customizing the code
\f0\b0\fs24 \
PS-MOPS can run on a single machine or on a (homogeneous) cluster. Either way, some changes are needed both in source and in configuration files to reflect the installation topology.\
\pard\tx220\tx720\tx1440\tx2160\tx2880\tx3600\tx4320\tx5040\tx5760\tx6480\tx7200\tx7920\tx8640\li720\fi-720\qj\pardirnatural
\ls4\ilvl0\cf0 {\listtext	1.	}Edit MOPS/src/tools/insertFPDetections/insertFPDetections and set %jobs[HOSTS] array (line 118) to the list of host-name(s) that will run PS-MOPS.\
{\listtext	2.	}Edit MOPS/src/JPL/ssd_1/*/Makefile the scp command(s) in the install rule to install the corresponding binaries to the machines in the cluster as well as the localhost.\
\pard\tx720\tx1440\tx2160\tx2880\tx3600\tx4320\tx5040\tx5760\tx6480\tx7200\tx7920\tx8640\qj\pardirnatural
\cf0 \
\

\f1\b\fs28 Installation
\f0\b0\fs24 \
Copy MOPS/src/tools/fpierfed/nstall.py to MOPS/src and execute that script. It uses values from $MOPS_HOME and $PERL5LIB if defined. Inspect the output for errors and fix any error encountered. Once instal.py executes without errors, rsync $MOPS_HOME/data over from a sane installation.\
\
\

\f1\b\fs28 Configuration
\f0\b0\fs24 \
Once installed, PS-MOPS can be configured by editing three files:\
\pard\tx220\tx720\tx1440\tx2160\tx2880\tx3600\tx4320\tx5040\tx5760\tx6480\tx7200\tx7920\tx8640\li720\fi-720\qj\pardirnatural
\ls5\ilvl0\cf0 {\listtext	1.	}$MOPS_HOME/config/cluster.cf\
{\listtext	2.	}$MOPS_HOME/config/backend.cf\
\ls5\ilvl0{\listtext	3.	}$MOPS_HOME/config/master.cf\
\pard\tx720\tx1440\tx2160\tx2880\tx3600\tx4320\tx5040\tx5760\tx6480\tx7200\tx7920\tx8640\qj\pardirnatural
\cf0 Of these, master.cf customizes the behaviour of the system from a scientific standpoint. backend.cf defines database access whereas cluster.cf defines the names of the nodes in the cluster running PS-MOPS. In case of a single machine system, only localhost needs to be present. It is important that those machine names are the same as those used in the "Customizing the code" section.\
\pard\tx720\tx1440\tx2160\tx2880\tx3600\tx4320\tx5040\tx5760\tx6480\tx7200\tx7920\tx8640\qj\pardirnatural
\cf0 \
\

\f1\b\fs28 Running PS-MOPS
\f0\b0\fs24 \
The first thing to do in running PS-MOPS is to create a set of detections in the database. This is accomplished by issuing the command\
	shell> buildInstance $MOPS_DBINSTANCE --model=1000 --survey=main --shape\
\
The pipeline itself is run by issuing\
	shell> dtctl --finish &; lodctl --finish &\
\
Progress can be inspected by looking at the database itself or by using the obsTool command line utility. A web interface is also available, whose installation and use require\
\pard\tx220\tx720\tx1440\tx2160\tx2880\tx3600\tx4320\tx5040\tx5760\tx6480\tx7200\tx7920\tx8640\li720\fi-720\qj\pardirnatural
\ls6\ilvl0\cf0 {\listtext	1.	}Apache httpd server.\
{\listtext	2.	}mod_perl\
{\listtext	3.	}Mason perl web framework.\
\pard\tx720\tx1440\tx2160\tx2880\tx3600\tx4320\tx5040\tx5760\tx6480\tx7200\tx7920\tx8640\qj\pardirnatural
\cf0 \
\pard\tx720\tx1440\tx2160\tx2880\tx3600\tx4320\tx5040\tx5760\tx6480\tx7200\tx7920\tx8640\qj\pardirnatural
\cf0 \
\
\
}